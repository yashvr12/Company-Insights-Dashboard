<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Jobs Search</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
        <style>
            .pagination li .page-link {
                background-color: #212529 !important;
                border-color: #666 !important;
                color: #fff;
            }

            .pagination li.active .page-link {
                background-color: #666 !important;
                border-color: #666 !important;
            }

            .pagination li:not(.active) .page-link:hover {
                background-color: #363c42 !important;
                color: #fff;
                border-color: #888 !important;
            }
            .sort {
                background-color: unset;
                border: none;
                float: right;
            }
            .sort svg {
                height: 20px;
                width: 20px;
            }
            .card {
                background-color: #2a2f35;
            }
            .company {
                font-weight: 600;
            }
            .industry {
                font-size: 16px;
            }
            .location {
                font-size: 14px;
            }
            .hide {
                height: 0;
                overflow: hidden;
            }
        </style>
    </head>
    <body class="bg-dark text-white">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="/">Jobs</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/HimanshuChandnani/">Github</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.linkedin.com/in/himanshu-chandnani1/">Linkedin</a>
                        </li>
                        <!-- <li class="nav-item">
                            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                        </li> -->
                    </ul>
                </div>
            </div>
        </nav>

        <!-- <div class="container">
            <div class="row gy-4">
                {%for i in data%}
                <div class="col-lg-3">
                    <div class="card px-3 py-2">
                        <div class="company">{{i.company_name}}</div>
                        {%if i.industry | string != "nan"%}
                        <div class="industry">{{i.industry}}</div>
                        {%endif%} {%if i.location | string != "nan"%}
                        <div class="location">{{i.location}}</div>
                        {%endif%}
                    </div>
                </div>
                {%endfor%}
            </div>
        </div> -->

        <div class="container py-5">
            <h3 class="mb-4 d-flex justify-content-between align-items-center">
                Search results: {{total_results}}
                <button onclick="switchView()" class="btn btn-dark p-2" style="line-height: 0">
                    <svg viewBox="0 0 24 24" fill="#fff" width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M17.2929 2.29289C17 2.58579 17 3.05719 17 4V17C17 17.9428 17 18.4142 17.2929 18.7071C17.5858 19 18.0572 19 19 19C19.9428 19 20.4142 19 20.7071 18.7071C21 18.4142 21 17.9428 21 17V4C21 3.05719 21 2.58579 20.7071 2.29289C20.4142 2 19.9428 2 19 2C18.0572 2 17.5858 2 17.2929 2.29289Z" fill="#ffffff"></path>
                            <path d="M10 7C10 6.05719 10 5.58579 10.2929 5.29289C10.5858 5 11.0572 5 12 5C12.9428 5 13.4142 5 13.7071 5.29289C14 5.58579 14 6.05719 14 7V17C14 17.9428 14 18.4142 13.7071 18.7071C13.4142 19 12.9428 19 12 19C11.0572 19 10.5858 19 10.2929 18.7071C10 18.4142 10 17.9428 10 17V7Z" fill="#ffffff"></path>
                            <path d="M3.29289 9.29289C3 9.58579 3 10.0572 3 11V17C3 17.9428 3 18.4142 3.29289 18.7071C3.58579 19 4.05719 19 5 19C5.94281 19 6.41421 19 6.70711 18.7071C7 18.4142 7 17.9428 7 17V11C7 10.0572 7 9.58579 6.70711 9.29289C6.41421 9 5.94281 9 5 9C4.05719 9 3.58579 9 3.29289 9.29289Z" fill="#ffffff"></path>
                            <path d="M3 21.25C2.58579 21.25 2.25 21.5858 2.25 22C2.25 22.4142 2.58579 22.75 3 22.75H21C21.4142 22.75 21.75 22.4142 21.75 22C21.75 21.5858 21.4142 21.25 21 21.25H3Z" fill="#ffffff"></path>
                        </g>
                    </svg>
                </button>
            </h3>
            <div id="analysis" class="row g-4 hide">
                <div class="col-lg-6">{{plots["rating"] | safe}}</div>
                <div class="col-lg-6">{{plots["size"] | safe}}</div>
                <div class="col-lg-6">{{plots["age"] | safe}}</div>
                <div class="col-lg-6">{{plots["best"] | safe}}</div>
            </div>
            <div id="table">
                <table class="table mt-3 table-dark table-hover">
                    <thead>
                        <tr>
                            {%for i in data[0]%}
                            <th>
                                {{i}}
                                <button class="sort" onclick="sortby('{{i}}')">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <path opacity="0.5" d="M16 18L16 6M16 6L20 10.125M16 6L12 10.125" stroke="#d1d1d1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                            <path d="M8 6L8 18M8 18L12 13.875M8 18L4 13.875" stroke="#d1d1d1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </g>
                                    </svg>
                                </button>
                            </th>
                            {%endfor%}
                        </tr>
                    </thead>
                    <tbody>
                        {%for i in data%}
                        <tr>
                            {%for j in i%}
                            <td>{{i[j]}}</td>
                            {%endfor%}
                        </tr>
                        {%endfor%}
                    </tbody>
                </table>
            </div>
            <nav>
                <ul class="pagination mt-4 justify-content-center">
                    <li class="page-item">
                        <button onclick="toPage(0)" class="page-link">&laquo;</button>
                    </li>
                    <li class="page-item {%if page - 1 < 0%}disabled{%endif%}">
                        <button onclick="toPage('{{page - 1}}')" class="page-link">Prev</button>
                    </li>
                    {%for i in range(page - 5, page + 5)%} {%if i >= 0 and i <= total_results / 50%}
                    <li class="page-item {%if page == i%}active{%endif%}">
                        <button onclick="toPage('{{i}}')" class="page-link">{{i}}</button>
                    </li>
                    {%endif%} {%endfor%}
                    <li class="page-item {%if (page + 1) * 50 > total_results%}disabled{%endif%}">
                        <button onclick="toPage('{{page + 1}}')" class="page-link">Next</button>
                    </li>
                    <li class="page-item">
                        <button onclick="toPage('{{(total_results / 50) | int}}')" class="page-link">&raquo;</button>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
    <script>
        const url = new URL(window.location.href);
        const params = new URLSearchParams(url.search);

        const toPage = (page) => {
            const existing = params.get("page");
            if (existing) {
                params.delete("page");
            }
            params.append("page", page);
            window.location.href = `search?${params.toString()}`;
        };

        const sortby = (field) => {
            const existing = params.get("sortby");
            if (existing) {
                params.delete("sortby");
                params.append("sortby", `${existing[0] == "a" && existing.slice(2) == field ? "d" : "a"}_${field}`);
            } else {
                params.append("sortby", `a_${field}`);
            }
            window.location.href = `search?${params.toString()}`;
        };

        let view = "table";
        const switchView = () => {
            if (view == "table") {
                document.getElementById("table").classList.add("hide");
                document.getElementById("analysis").classList.remove("hide");
                view = "analysis";
            } else {
                document.getElementById("table").classList.remove("hide");
                document.getElementById("analysis").classList.add("hide");
                view = "table";
            }
        };
    </script>
</html>
